%%{init: {'theme': 'dark', 'themeVariables': {'fontSize': '14px'}}}%%
graph LR

%% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
%% Go Datagrid Component â€” Architecture v1.5
%% Regenerate: mmdc -i datagrid_architecture.mmd -o datagrid_architecture.png
%% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

%% â”€â”€ CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph CONFIG["ğŸ“‹ Configuration"]
    CATALOG["JSON Catalog<br/>(columns, labels,<br/>filters, icons, i18n)"]
    LOV["LOV Sources<br/>(List-of-Values)<br/>static / SQL / tree"]
end

%% â”€â”€ GO CORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph CORE["âš™ï¸ Go Datagrid Core"]
    direction TB
    RENDER["datagrid.Render()<br/>Main entry point"]
    SQLGEN["SQL Generator<br/>Go templates â†’<br/>parameterized query"]
    FILTER["Filter Engine<br/>Multi-column, search,<br/>default filters"]
    SORT["Sort Engine<br/>3-phase (ASC/DESC/NONE)<br/>NULLS FIRST/LAST<br/>dynamic JSON sort"]
    PAGE["Pager<br/>Offset or Cursor-based"]
    PIVOT["pivot.Render()<br/>Aggregation, subtotals,<br/>dimension swap"]
end

CATALOG --> RENDER
LOV --> FILTER
RENDER --> SQLGEN
RENDER --> FILTER
RENDER --> SORT
RENDER --> PAGE

%% â”€â”€ DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph DB["ğŸ˜ PostgreSQL"]
    EXEC["pg_execute_grid()<br/>Streaming JSON/CSV<br/>pg_trgm similarity"]
end

SQLGEN --> DB

%% â”€â”€ OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph OUTPUT["ğŸ–¥ï¸ Browser"]
    HTMX["HTMX Partial<br/>(HTML table fragment)"]
    DETAIL["Detail Sidebar<br/>(Record inspector)"]
    CHOOSER["Column Chooser<br/>(Visibility, order,<br/>width persistence)"]
    EXPORT["Export<br/>(CSV, clipboard)"]
end

DB --> HTMX
HTMX --> DETAIL
HTMX --> CHOOSER
HTMX --> EXPORT

%% â”€â”€ CONSUMERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph CONSUMERS["ğŸ“¦ Consumer Apps"]
    JIRAMNTR["Jiramntr<br/>BI Reports, KPI,<br/>Employee tables"]
    JOHANNA["Johanna<br/>AI SQL results"]
    CUSTOM["Custom Apps"]
end

HTMX --> CONSUMERS

%% â”€â”€ STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
classDef config fill:#4a3a1a,stroke:#f39c12
classDef core fill:#1a3a4a,stroke:#3498db
classDef db fill:#2d4a2d,stroke:#27ae60
classDef output fill:#3a2a4a,stroke:#9b59b6
classDef consumer fill:#4a2d2d,stroke:#e74c3c

class CATALOG,LOV config
class RENDER,SQLGEN,FILTER,SORT,PAGE,PIVOT core
class DB db
class HTMX,DETAIL,CHOOSER,EXPORT output
class JIRAMNTR,JOHANNA,CUSTOM consumer
