# DATAGRID UI/UX Technical Guide

The `DATAGRID` is a metadata-driven presentation layer designed for high-density, expert BI (Business Intelligence) applications. It translates JSON catalogs into interactive, persistence-enabled PostgreSQL tables.

---

## üèóÔ∏è Core Concept
Instead of hardcoding table structures, the system derives columns, filters, and behavior from a centralized **Catalog**.
- **Backend**: Go library parses the catalog and generates optimized SQL (Multi-sort, Search, Pagination).
- **Frontend**: Lightweight JS (`datagrid.js`) handles interactions and local persistence.
- **Communication**: Seamless integration with **HTMX** for zero-refresh updates.

---

## üìÇ Catalog JSON Format
The catalog defines the "DNA" of a resource.

### Example: `personnel.json`
```json
{
  "version": "1.0",
  "title": "Personnel Registry",
  "icon": "fa-users",
  "datagrid": {
    "defaults": { "page_size": 20, "sort_column": "name", "sort_direction": "asc" },
    "filters": {
      "status": { "column": "status", "type": "text" }
    },
    "columns": {
      "id": { "visible": false },
      "email": { "labels": { "en": "Email Address", "hu": "E-mail c√≠m" } }
    },
    "lovs": {
      "status": [
        { "value": "active", "label": { "en": "Active", "hu": "Akt√≠v" } },
        { "value": "retired", "label": { "en": "Retired", "hu": "Nyugd√≠jas" } }
      ]
    }
  },
  "objects": [
    {
      "name": "personnel",
      "columns": [
        { "name": "id", "type": "bigint", "primary_key": true },
        { "name": "name", "type": "text", "labels": { "en": "Name", "hu": "N√©v" } }
      ]
    }
  ]
}
```

---

## üñ±Ô∏è Expert Interactions

### 1. 3-Phase Loop Sorting
Clicking a column header cycles through three states:
1.  **ASC (‚ñ≤)**: Ascending order.
2.  **DESC (‚ñº)**: Descending order.
3.  **NONE**: Removes column from sort.

### 2. Multi-Column Sorting
- **Action**: `Ctrl + Click` on headers.
- **Visual**: Sort sequence is indicated by subscript ranks (e.g., `‚ñ≤‚ÇÅ`, `‚ñº‚ÇÇ`).
- **Persistence**: Remembers the exact multi-sort state across sessions.

### 3. Expert Shortcuts
- **Shift + Click**: Instantly hides a column. No need to open the column chooser.
- **Column Chooser**: The ‚öôÔ∏è icon in the toolbar allows toggling visibility for all defined columns.

---

## üß© Forensic DOM Standard
To enable robust testing and AI interactions, the Datagrid follows strict DOM tagging:
- **`col-{field}`**: Every cell (`<td>`) is tagged with its field name.
- **`data-json`**: Row metadata is embedded as a JSON string for easy extraction.
- **`data-sort`**: Headers contain the current sort state.

---

## üíæ Persistence & State
All UI state is tracked in `localStorage` under keys derived from the resource code:
- `dg-{code}-vis`: Column visibility bitmask.
- `dg-{code}-order`: Column display order.
- `dg-{code}-sort`: Serialized sort array.

---
*Generated by Antigravity Engine | DATAGRID v1.2.0 Standard*
